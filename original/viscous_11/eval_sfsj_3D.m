function [sf,sj]=eval_sfsj_3D(sf,sj,w1,w2,w3,dx,dy,dz,n1,n2,con,cono,...
    conx,cony,conz,conxx,conyy,conzz,phi,phixx,phiyy,phizz,gbasis,dt,diff,T,chi)

cont=(con-cono)/dt;

diffT=diff*T;
term_=-1.0/(n1*(con^2.0))+(1./n2)*(1-con)^-2.0;
term__=2.0*(1.0/(n1*con^3.0)+1.0/(n2*(1-con)^3.0));
conxyz_sq=conx^2.0+cony^2.0+conz^2.0;
chi_term=1./con+(1./10.)*(1./(1.-con))-2*chi;
conxyz=conx+cony+conz;
conxxyyzz=conxx+conyy+conzz;

wd=w1*w2*w3*dx*dy*dz;

for i=1:1:64
    
    diffTphii=diffT*phi(i);
    phiixxyyzz=phixx(i)+phiyy(i)+phizz(i);
    
    sf(gbasis(i))=sf(gbasis(i))-wd*...
        (cont*phi(i)-diffTphii*(term_*conxyz_sq+chi_term*conxxyyzz)...
        +conxxyyzz*phiixxyyzz);
    
%     sf(gbasis(i))=sf(gbasis(i))-w1*w2*w3*dx*dy*dz*...
%         (cont*phi(i)-diff*T*phi(i)*(-1.0/(con^2.0)...
%         +(1./10.)*(1-con)^-2.0)*(conx^2.0+...
%         cony^2.0+conz^2.0)-diff*T*phi(i)*...
%         (1/con+(1./10.)*(1./(1.-con))-2*chi)*...
%         (conxx+conyy+conzz)+(conxx+conyy+conzz)*...
%         (phixx(i)+phiyy(i)+phizz(i)));
    for j=1:1:64
        
        phijxxyyzz=phixx(j)+phiyy(j)+phizz(j);
        
        sj(gbasis(i),gbasis(j))=sj(gbasis(i),gbasis(j))+wd*...
            (phi(i)*phi(j)/dt-diffTphii*(phi(j)*term__*conxyz_sq...
            +term_*2*phi(j)*conxyz+phi(j)*term_*conxxyyzz...
            +chi_term*phijxxyyzz)+phijxxyyzz*phiixxyyzz);
        
%         sj(gbasis(i),gbasis(j))=sj(gbasis(i),gbasis(j))+wd*...
%             (phi(i)*phi(j)/dt-diff*T*phi(i)*((2*phi(j)...
%             /(con^3.0)+2*phi(j)/(10*(1-con)^3))*...
%             (conx^2.0+cony^2.0+conz^2.0)+(-1/con^2.0+...
%             1/(10*(1-con)^2.0))...
%             *(2*conx*phi(j)+2*cony*phi(j)+2*conz*phi(j)))-diff*T*phi(i)...
%             *((-phi(j)/con^2.0+phi(j)/(10*(1-con)^2))*...
%             (conxx+conyy+conzz)+(1/con+1/(10*(1-con))-2*chi)...
%             *(phixx(j)+phiyy(j)+phizz(j)))+(phixx(j)+phiyy(j)+phizz(j))...
%             *(phixx(i)+phiyy(i)+phizz(i)));
    end
end

end